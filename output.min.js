/*! tic-tac-toe-client 2016-12-11 */
!function(){"use strict";function a(a,b,c){return"undefined"==typeof c||0===+c?Math[a](b):(b=+b,c=+c,isNaN(b)||"number"!=typeof c||c%1!==0?NaN:(b=b.toString().split("e"),b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c))),b=b.toString().split("e"),+(b[0]+"e"+(b[1]?+b[1]+c:c))))}Math.round10||(Math.round10=function(b,c){return a("round",b,c)}),Math.floor10||(Math.floor10=function(b,c){return a("floor",b,c)}),Math.ceil10||(Math.ceil10=function(b,c){return a("ceil",b,c)})}(),function(a){"use strict";function b(){var b=function(b,c,d,e,f,g,h,i){var j,k,l,m="http://www.w3.org/2000/svg",n=document.createElementNS(m,"rect");n.setAttributeNS(null,"x",c+""),n.setAttribute("y",d+""),n.setAttribute("width",e+""),n.setAttribute("height",e+""),n.setAttribute("fill",f+""),n.setAttribute("stroke",g+""),n.setAttribute("stroke-width",h+""),i&&(k=+c+i.offsetX+"",l=+d+i.offsetY+"",j=document.createElementNS(m,"image"),j.setAttributeNS("http://www.w3.org/1999/xlink","href",i.path),j.setAttribute("x",k),j.setAttribute("y",l),j.setAttribute("height",i.height+""),j.setAttribute("width",i.width+"")),a(b).append(a(n),a(j))};return{createRect:b}}angular.module("tttGame.services").factory("svgDrawer",[b])}(jQuery),function(){"use strict";angular.module("tttGame.directives").directive("tttAllGames",function(){return{restrict:"A",templateUrl:"templates/all-games-template.html"}})}(),function(){"use strict";angular.module("tttGame.directives").directive("tttBoard",function(){return{restrict:"A",templateUrl:"templates/board.html",scope:{gameInfo:"=info"},link:function(a,b,c,d,e){a.setTile=function(b,c){a.$parent.vm.tile&&(a.$parent.vm.tile.row=b,a.$parent.vm.tile.col=c)}}}})}(),function(){"use strict";angular.module("tttGame.directives").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b===a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}})}(),function(){"use strict";angular.module("tttGame.directives").directive("noSpaces",function(){return{require:"ngModel",scope:{input:"=noSpaces"},restrict:"A",link:function(a,b,c,d){d.$validators.noSpaces=function(){}}}})}(),function(){"use strict";angular.module("tttGame.directives").directive("svgBoard",["svgDrawer",function(a){return{restrict:"A",templateUrl:"",scope:{board:"=board"},link:function(b,c){for(var d={path:"",width:40,height:40,offsetX:5,offsetY:5},e=0,f=0,g=0;e<b.board.length;e+=1,g+=51)e%3===0&&0!==e&&(f+=51,g=0),"O"===b.board[e]?(d.path="../img/greenCircle_128.png",a.createRect(c,g,f,50,"#454545","#2a9fd6",2,d)):"X"===b.board[e]?(d.path="../img/reg_X_symbol_128.png",a.createRect(c,g,f,50,"#454545","#2a9fd6",2,d)):a.createRect(c,g,f,50,"#454545","#2a9fd6",2)}}}])}(),function(){"use strict";var a=function(a,b,c,d,e){var f="authentication",g=function(c){var d=b.defer(),f="Username="+(c.username||"")+"&Password="+(c.password||"")+"&ConfirmPassword="+(c.confirmPassword||"")+"&Email="+(c.email||"");return a.post(e+"api/account/register",f,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise},h=function(d){var g=b.defer(),h="grant_type=password&username="+(d.username||"")+"&password="+(d.password||"");return a.post(e+"Token",h,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){var d=b.data.access_token,e=new Date;e.setHours(e.getHours()+72),c.put(f,d,{expires:e}),a.defaults.headers.common.Authorization="Bearer "+d,i().then(function(){g.resolve(b)},function(a){g.reject(a)})},function(a){g.reject(a)}),g.promise},i=function(){var c=b.defer();return a.get(e+"api/Account/userinfo").then(function(a){d.setUser(a.data),c.resolve(a.data)},function(a){c.reject(a)}),c.promise},j=function(){var c=b.defer();return a.get(e+"api/games/info").then(function(a){c.resolve(a.data)},function(a){c.reject(a)}),c.promise};return{userRegistration:g,login:h,getIdentity:i,userFullInformation:j,isAuthenticated:function(){return!!c.get(f)},logout:function(){c.remove(f),a.defaults.headers.common.Authorization=null,d.removeUser()}}};angular.module("tttGame.services").factory("auth",["$http","$q","$cookies","identity","domain",a])}(),function(){"use strict";function a(a,b,c){var d=function(d,e){var f=b.defer();return a.get(c+d,{params:e}).then(function(a){f.resolve(a.data)},function(a){f.reject(a)}),f.promise},e=function(d,e){var f=b.defer();return a.post(c+d,e).then(function(a){f.resolve(a.data)},function(a){f.reject(a)}),f.promise};return{getRequest:d,postRequest:e}}angular.module("tttGame.services").factory("dataService",["$http","$q","domain",a])}(),function(){"use strict";function a(a,b){function c(b){return a.postRequest("api/games/create",b)}function d(b,c){return c=c||"",a.postRequest("api/games/join?id="+b,{password:c})}function e(b,c){var d="api/games/status?gameId="+b+"&isForJoin="+!!c;return a.getRequest(d)}function f(b){return a.postRequest("api/games/play",b)}function g(c,d,e,f,g){var h=b.defer(),i={state:c,gameName:d,playerName:e,count:f,order:g},j="api/games/all/";return a.getRequest(j,i).then(function(a){h.resolve(a)},function(a){h.reject(a)}),h.promise}function h(b,c,d,e,f){var g={state:b,gameName:c,playerName:d,count:e,order:f};return a.getRequest("api/games/PrivateGames/",g)}return{createGame:c,joinGame:d,gameDetails:e,play:f,allGames:g,getPrivateGames:h}}angular.module("tttGame.services").factory("gameManager",["dataService","$q",a])}(),function(){"use strict";var a=function(a){var b={},c=a.defer();return{getUser:function(){return this.isAuthenticated()?a.resolve(b):c.promise},isAuthenticated:function(){var a=0!==Object.getOwnPropertyNames(b).length;return a},setUser:function(a){b=a,c.resolve(a)},removeUser:function(){b={},c=a.defer()},getUserNoPromise:function(){return b}}};angular.module("tttGame.services").factory("identity",["$q",a])}(),function(){"use strict";function a(a){return a.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"1000",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},{success:function(b,c){a.success(b,c)},warning:function(b,c){a.warning(b,c)},error:function(b,c){a.error(b,c)}}}angular.module("tttGame.services").factory("notifier",["toastr",a])}(),function(){"use strict";function a(){return function(a){switch(a){case"X":return"red-X-symbol-background";case"O":return"green-circle-background";default:return" "}}}angular.module("tttGame.filters").filter("backgroundImageFilter",a)}(),function(){"use strict";function a(){return function(a){switch(a.state){case 0:return"Waiting for opponent!";case 1:case 2:return"X"===a.firstPlayerSymbol&&1===a.state||"O"===a.firstPlayerSymbol&&2===a.state?"First player turn.":"Second player turn.";case 3:case 4:return"X"===a.firstPlayerSymbol&&3===a.state||"O"===a.firstPlayerSymbol&&4===a.state?"First player won":"Second player won";case 5:return"Draw. Deal with it."}}}angular.module("tttGame.filters").filter("gameStateFilter",a)}(),function(){"use strict";function a(){return function(a){switch(a){case"-":return" ";default:return a}}}angular.module("tttGame.filters").filter("renderSymbol",a)}(),function(){"use strict";function a(){return function(a,b){if(!b)return 0;var c=100*a;return Math.round10(c/b)}}angular.module("tttGame.filters").filter("gamesWonPercentageFilter",a)}(),function(){"use strict";function a(){var a=this;a.linkToRepo="https://github.com/M-Yankov/Tic-Tac-Toe-Client"}angular.module("tttGame.controllers").controller("AboutController",[a])}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a,b,c,f,g){k.isLoaded=!1,e.allGames(a,b,c,f,g).then(function(a){k.allGames=a,k.isLoaded=!0},function(a){console.error(a);var b={};if(d.error(a.data.Message,"Error"),k.isLoaded=!0,a.data&&a.data.ModelState&&a.data.ModelState[""]){b=a.data.ModelState[""];for(var c in b)b.hasOwnProperty(c)&&d.error(b[c],a.statusText)}})}function i(){function f(a){function b(a,b,c){return a.FirstPlayerSymbol===b&&a.FirstPlayerName===c||a.SecondPlayerSymbol===b&&a.SecondPlayerName===c}if(k.gameInfo&&0!==a.State){if(a.State>=3){var e=3===a.State?"X":"O";return 5===a.State?d.warning("Draw!",""):b(a,e,l)?d.success("You win!","Congratulations"):d.error("You lose!","Game over"),console.log("interval canceled on win"),void c.cancel(j)}if(k.gameInfo.SecondPlayerName!==a.SecondPlayerName)return d.warning("Opponent just join","Info"),$("#btn-share").remove(),console.log("Interval canceled on player join"),void c.cancel(j);var f=1===a.State?"X":"O";return b(a,f,l)?(console.log("Interval canceled - current player is on turn"),void c.cancel(j)):void 0}}var h=b.id,l=g.getUserNoPromise().Email;h&&e.gameDetails(h).then(function(a){f(a),k.gameInfo=a,k.gameInfo.State>=3&&c.cancel(j)},function(b){c.cancel(i),console.log("Interval canceled on error"),d.error("Reasons: id or you are not participate in the game","Game not found!"),a.path("/games/all")})}var j,k=this;k.tile={},k.isGameCreating=!1,k.isInGameJoiningProcess=!1,k.isLoaded=!1,k.joinGameDetails={};var l=a.url().includes("join");l&&e.gameDetails(b.id,!0).then(function(b){g.getUser().then(function(c){(b.SecondPlayerName||0!==b.State||b.FirstPlayerName===c.Email)&&(d.error("Game not available.","An error"),a.path("/games/all")),k.joinGameDetails=b})},function(b){d.error(b.data.Message||"","Game not found!"),a.path("/games/all")}),b.id&&!l&&(i(),j=c(i,3e3)),f.$on("$destroy",function(){c.cancel(j),console.log("Interval canceled on destroy")}),h(),k.getAllGames=h,k.change=function(a,b){a||(b.password="")},k.createGame=function(b){k.isGameCreating=!0,e.createGame(b).then(function(b){d.success("Game created","Success!"),k.isGameCreating=!1,a.path("/game/"+b)},function(a){d.error(a.data.Message||"Cannot create game","Error"),k.isGameCreating=!1})},k.joinGame=function(b,c){k.isInGameJoiningProcess=!0,e.joinGame(b,c).then(function(b){d.success("You just joined in the game!","Success!"),k.isInGameJoiningProcess=!1,a.path("/game/"+b)},function(a){k.isInGameJoiningProcess=!1,d.error(a.data.Message||"","Error!")})},k.play=function(a,b){return b.$dirty?k.gameInfo.State>=3?void d.warning("Game already finished!","Warning"):0===k.gameInfo.State?void d.warning("You must wait for opponent!","Warning"):(a.gameId=k.gameInfo.Id,void e.play(a).then(function(){i(),c.cancel(j),j=c(i,3e3)},function(a){var b={};if(d.error(a.data.Message,"Error"),a.data&&a.data.ModelState&&a.data.ModelState[""]){b=a.data.ModelState[""];for(var c in b)b.hasOwnProperty(c)&&d.error(b[c],a.statusText)}})):void d.warning("First chose a tile!","Warning")},k.copyLink=function(a){var b=document.createElement("input");b.value=document.location.host+"/game/join/"+a,b.style.position="absolute",b.style.left="-120%",b.style.top="0",b.id="copy-link",document.body.appendChild(b),b.select();document.execCommand("copy");document.body.removeChild(b)}}angular.module("tttGame.controllers").controller("GameController",["$location","$routeParams","$interval","notifier","gameManager","$scope","identity",a])}(),function(){"use strict";function a(a,b,c){function d(){c.getUser().then(function(a){e.globallySetCurrentUser=a})}var e=this;e.hello="Hello",e.screen1="../img/screen1.png",e.screen2="../img/screen2.png",e.screen3="../img/screen3.png",e.logo="../img/back.png",d(),e.logout=function(){e.globallySetCurrentUser=void 0,b.logout(),d(),a.path("/")}}angular.module("tttGame.controllers").controller("HomeController",["$location","auth","identity",a])}(),function(){"use strict";function a(){}angular.module("tttGame.controllers").controller("HowToController",[a])}(),function(){"use strict";function a(a,b,c){var d=this;d.isProcessing=!1,d.logUser=function(e,f){d.hasError=!1,d.isProcessing=!0,f.$valid?b.login(e).then(function(b){c.success(b.data.userName+"!","Welcome:"),a.path("/")},function(a){a.data?c.error(a.data.error_description,a.statusText):c.error(JSON.stringify(a),a.statusText),d.hasError=!0,d.isProcessing=!1}):(c.error("Check requirements","Invalid form"),d.hasError=!0,d.isProcessing=!1)}}angular.module("tttGame.controllers").controller("LoginController",["$location","auth","notifier",a])}(),function(){"use strict";function a(a,b,c){var d=this;d.isProcessing=!1,d.makeRegistration=function(e,f){d.hasError=!1,f.$valid?(d.isProcessing=!0,b.userRegistration(e).then(function(){c.success("Now you must login!","Success registration!"),d.isProcessing=!1,a.path("/login")},function(a){if(c.error("Contact support!","General error"),d.hasError=!0,d.isProcessing=!1,a.data&&a.data.ModelState&&a.data.ModelState[""]){var b=a.data.ModelState[""];for(var e in b)b.hasOwnProperty(e)&&c.error(b[e],a.statusText)}})):(c.error("Invalid form!","See messages."),d.hasError=!0)}}angular.module("tttGame.controllers").controller("RegisterController",["$location","auth","notifier",a])}(),function(){"use strict";function a(a,b){function c(){a.userFullInformation().then(function(a){d.fullInformation=a},function(){b.error("Cannot access data","Error")})}var d=this;c()}angular.module("tttGame.controllers").controller("UserDetailsController",["auth","notifier",a])}(),function(){"use strict";function a(a,b){function c(c,e,f,g,h){d.isLoaded=!1,a.getPrivateGames(c,e,f,g,h).then(function(a){d.allGames=a,d.isLoaded=!0},function(a){var c={};if(d.isLoaded=!0,b.error(a.data.Message,"Error"),a.data&&a.data.ModelState[""]){c=a.data.ModelState[""];for(var e in c)c.hasOwnProperty(e)&&b.error(c[e],a.statusText)}})}var d=this;d.isLoaded=!1,c(),d.userGames=!0,d.getAllGames=c}angular.module("tttGame.controllers").controller("UsersGamesController",["gameManager","notifier",a])}();